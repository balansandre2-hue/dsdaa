    </div>
                </div>
            </div>

            <div class="block-container">
                <div class="block-header"><span>ПОИСК ПО ЛОТАМ</span></div>
                <div class="p-3 bg-[#1a1a1a]">
                    <input type="text" id="search" placeholder="Название..." class="w-full mb-2 bg-[#111] border-[#333]">
                    <button class="btn-forum w-full">НАЙТИ</button>
                </div>
            </div>
        </aside>

        <main class="flex-grow w-full">
            
            <div class="flex justify-between items-center mb-3 px-1 border-b border-[#2d2d2d] pb-2">
                <div class="text-md font-bold text-white uppercase tracking-wider" id="cat-title">Общий каталог</div>
                <div class="text-tiny text-textMuted">Вид: <span class="text-white cursor-pointer hover:underline">Сетка</span></div>
            </div>

            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Grid Items -->
            </div>

            <div id="empty-view" class="hidden p-12 text-center border border-dashed border-[#333] rounded bg-[#151515]">
                <div class="text-textMuted mb-2">Ничего не найдено</div>
                <button onclick="renderProducts('all')" class="text-link hover:underline text-tiny">Показать все</button>
            </div>

        </main>

    </div>

    <!-- Fixed Contact Widget -->
    <div class="fixed bottom-6 right-6 z-40 flex flex-col gap-3">
        <div class="group relative">
            <div class="absolute right-full mr-3 top-1/2 -translate-y-1/2 bg-[#1c1c1c] border border-[#333] text-tiny px-2 py-1 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap">
                Написать в Telegram
            </div>
            <a href="https://t.me/lkx_kxl" target="_blank" class="widget-btn bg-[#0088cc] text-white">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 11.944 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
            </a>
        </div>
    </div>

    <footer class="mt-auto border-t border-[#2d2d2d] bg-[#151515] py-6">
        <div class="max-w-[1100px] mx-auto px-4 flex justify-between items-center text-tiny text-textMuted">
            <div>
                &copy; 2026 TACTICAL MARKETPLACE.<br>
                Secure Connection via TLS 1.3
            </div>
            <div class="flex gap-6">
                <span class="hover:text-white cursor-pointer" onclick="openRules()">Правила сервиса</span>
                <a href="https://t.me/+l4Mt8VCqCf42ZDU5" target="_blank" class="hover:text-white text-link">Отзывы</a>
                <a href="https://t.me/lkx_kxl" target="_blank" class="hover:text-white font-bold">Поддержка 24/7</a>
            </div>
        </div>
    </footer>

    <!-- MODAL: Product -->
    <div id="modal-product" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-mask">
        <div class="bg-[#1c1c1c] w-full max-w-[600px] border border-[#444] shadow-2xl flex flex-col">
            <div class="block-header">
                <span id="mp-title">Просмотр лота</span>
                <button onclick="closeModal('modal-product')" class="text-textMuted hover:text-white px-2">✕</button>
            </div>
            
            <div class="p-5 flex gap-4 bg-[#181818]">
                <div class="w-[120px] h-[120px] bg-[#111] border border-[#2d2d2d] flex items-center justify-center text-tiny text-textMuted shrink-0 font-mono">
                    [ ФОТО ]
                </div>
                <div class="flex-grow">
                    <h2 class="text-md font-bold text-white mb-1" id="mp-name">Product Name</h2>
                    <div class="text-tiny text-textMuted mb-3">Лот #<span id="mp-id">000</span> | Продавец: <span id="mp-vendor" class="text-link hover:underline cursor-pointer">Vendor</span></div>
                    
                    <div class="p-2 bg-[#111] border border-[#2d2d2d] text-base text-[#ccc] min-h-[80px] mb-3 leading-relaxed" id="mp-desc">
                        Description
                    </div>

                    <div class="flex justify-between items-end">
                        <div class="flex flex-col">
                            <span class="text-tiny text-textMuted">Стоимость:</span>
                            <span class="text-xl font-bold text-link" id="mp-price">0 ₽</span>
                        </div>
                        <button onclick="addToCartCurrent()" class="btn-forum btn-action font-bold px-6 py-2">В КОРЗИНУ</button>
                    </div>
                </div>
            </div>
            
            <div class="bg-[#151515] p-2 border-t border-[#000] text-tiny flex justify-between px-4">
                <span class="text-textMuted">Гарантия сделки: <span class="text-[#38a169]">Да</span></span>
                <span class="text-textMuted">Доставка: <span class="text-white">СДЭК / Клад</span></span>
            </div>
        </div>
    </div>

    <!-- MODAL: Cart & Checkout -->
    <div id="modal-cart" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-mask">
        <div class="bg-[#1c1c1c] w-full max-w-[500px] border border-[#444] shadow-2xl flex flex-col max-h-[90vh]">
            <div class="block-header">
                <span id="cart-modal-title">Корзина</span>
                <button onclick="closeModal('modal-cart')" class="text-textMuted hover:text-white px-2">✕</button>
            </div>
            
            <!-- View 1: List -->
            <div id="view-cart-list" class="bg-[#181818] p-4 flex-grow overflow-y-auto">
                <div id="cart-list" class="space-y-2 mb-4"></div>
                <div id="cart-empty-msg" class="text-center text-textMuted py-4">Корзина пуста</div>
                
                <div id="cart-footer" class="hidden border-t border-[#2d2d2d] pt-3">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-textMuted text-tiny">Итого:</span>
                        <span class="text-lg font-bold text-white" id="cart-total">0 ₽</span>
                    </div>
                    <button onclick="toCheckout()" class="btn-forum btn-action w-full font-bold py-2">ОФОРМИТЬ ЗАКАЗ</button>
                </div>
            </div>

            <!-- View 2: Checkout -->
            <div id="view-checkout" class="hidden bg-[#181818] p-4 flex-grow overflow-y-auto">
                <div class="mb-3 flex items-center gap-2 text-tiny text-link cursor-pointer hover:underline" onclick="toCartView()">
                    <span>&laquo;</span> Назад в корзину
                </div>

                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <div class="text-tiny text-textMuted mb-1 font-bold uppercase">Страна</div>
                            <select id="co-country" class="w-full" onchange="updateCities()">
                                <option value="ru">Россия (RF)</option>
                                <option value="ua">Украина (UA)</option>
                                <option value="kz">Казахстан (KZ)</option>
                                <option value="by">Беларусь (BY)</option>
                            </select>
                        </div>
                        <div>
                            <div class="text-tiny text-textMuted mb-1 font-bold uppercase">Город</div>
                            <select id="co-city" class="w-full"></select>
                        </div>
                    </div>

                    <div>
                        <div class="text-tiny text-textMuted mb-1 font-bold uppercase">Email (для чека)</div>
                        <input type="email" class="w-full" placeholder="name@proton.me">
                    </div>

                    <div>
                        <div class="text-tiny text-textMuted mb-1 font-bold uppercase">Метод доставки</div>
                        <div class="grid grid-cols-2 gap-2 checkout-radio-group">
                            <label>
                                <input type="radio" name="delivery" value="courier" checked class="accent-[#d69e2e]">
                                <div class="text-tiny ml-2 text-[#ccc] font-bold">КУРЬЕР</div>
                            </label>
                            <label>
                                <input type="radio" name="delivery" value="drop" class="accent-[#d69e2e]">
                                <div class="text-tiny ml-2 text-[#ccc] font-bold">КЛАД (МАГНИТ)</div>
                            </label>
                        </div>
                    </div>

                    <div>
                        <div class="text-tiny text-textMuted mb-1 font-bold uppercase">Оплата</div>
                        <div class="space-y-1 checkout-radio-group">
                            <label>
                                <input type="radio" name="payment" value="usdt" checked class="accent-[#d69e2e]">
                                <div class="text-tiny ml-2 text-[#ccc] font-bold">USDT (TRC20)</div>
                            </label>
                            <label>
                                <input type="radio" name="payment" value="btc" class="accent-[#d69e2e]">
                                <div class="text-tiny ml-2 text-[#ccc] font-bold">BITCOIN (BTC)</div>
                            </label>
                            <label>
                                <input type="radio" name="payment" value="ltc" class="accent-[#d69e2e]">
                                <div class="text-tiny ml-2 text-[#ccc] font-bold">LITECOIN (LTC)</div>
                            </label>
                        </div>
                    </div>

                    <button onclick="toInvoice()" class="btn-forum btn-action w-full py-2 font-bold mt-2">ПОДТВЕРДИТЬ И ОПЛАТИТЬ</button>
                </div>
            </div>

            <!-- View 3: Invoice -->
            <div id="view-invoice" class="hidden bg-[#181818] p-4 text-center flex-grow overflow-y-auto">
                <div class="border border-[#2d2d2d] bg-[#111] p-3 mb-4">
                    <div class="text-tiny text-textMuted mb-1 uppercase font-bold">Ожидание оплаты</div>
                    <div id="timer" class="text-2xl font-mono text-accent font-bold animate-pulse">15:00</div>
                </div>
                
                <div class="text-left text-tiny space-y-2 mb-4 px-2">
                    <div class="flex justify-between border-b border-[#2d2d2d] pb-1">
                        <span class="text-textMuted">Сумма (RUB):</span>
                        <span class="text-white font-bold" id="inv-rub">0</span>
                    </div>
                    <div class="flex justify-between border-b border-[#2d2d2d] pb-1">
                        <span class="text-textMuted">К оплате (CRYPTO):</span>
                        <span class="text-link font-bold" id="inv-crypto">0</span>
                    </div>
                </div>

                <div class="mb-4 text-left">
                    <div class="text-tiny text-textMuted mb-1 font-bold uppercase">Кошелек (<span id="inv-wallet-name">TRC20</span>):</div>
                    <div class="bg-[#111] border border-[#2d2d2d] p-2 text-tiny text-white font-mono break-all cursor-pointer hover:border-[#555] select-all" id="inv-addr" onclick="copyWallet()">...</div>
                    <div class="text-right mt-1">
                        <span class="text-tiny text-link cursor-pointer hover:underline" onclick="copyWallet()">[ Скопировать ]</span>
                    </div>
                </div>

                <button onclick="finishOrder()" class="btn-forum w-full py-2 font-bold">Я ОПЛАТИЛ</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Rules -->
    <div id="modal-rules" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-mask">
        <div class="bg-[#1c1c1c] w-full max-w-[600px] border border-[#444] shadow-2xl">
            <div class="block-header">
                <span>ПРАВИЛА ПЛОЩАДКИ</span>
                <button onclick="closeModal('modal-rules')" class="text-textMuted hover:text-white px-2">✕</button>
            </div>
            <div class="p-6 bg-[#181818] text-[#ccc] space-y-4 max-h-[70vh] overflow-y-auto">
                <div>
                    <h3 class="text-white font-bold mb-1">1. ОБЩИЕ ПОЛОЖЕНИЯ</h3>
                    <p class="text-xs leading-relaxed text-[#999]">
                        1.1. Регистрируясь на площадке, вы соглашаетесь с тем, что администрация не несет ответственности за сделки, совершенные без участия Гаранта.<br>
                        1.2. Любые оскорбления, спам, флуд в темах караются блокировкой аккаунта без возможности восстановления.<br>
                        1.3. Попытки деанонимизации пользователей запрещены.
                    </p>
                </div>
                <div>
                    <h3 class="text-white font-bold mb-1">2. ТОРГОВЛЯ</h3>
                    <p class="text-xs leading-relaxed text-[#999]">
                        2.1. Товар должен полностью соответствовать описанию.<br>
                        2.2. Продавец обязан предоставить трек-номер или координаты клада в течение 24 часов после оплаты.<br>
                        2.3. Запрещена продажа воздуха, скам-схемы. Нарушение = перманентный бан.
                    </p>
                </div>
                <div>
                    <h3 class="text-white font-bold mb-1">3. ФИНАНСЫ</h3>
                    <p class="text-xs leading-relaxed text-[#999]">
                        3.1. Все расчеты проводятся исключительно в криптовалюте (USDT/BTC).<br>
                        3.2. Курс фиксируется на момент создания сделки.
                    </p>
                </div>
                <div class="border-t border-[#333] pt-4 mt-2">
                    <p class="text-tiny text-[#777] italic text-center">Незнание правил не освобождает от ответственности.</p>
                </div>
            </div>
            <div class="p-3 bg-[#151515] border-t border-[#2d2d2d] text-center">
                <button onclick="closeModal('modal-rules')" class="btn-forum px-6">Принимаю</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Escrow -->
    <div id="modal-escrow" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-mask">
        <div class="bg-[#1c1c1c] w-full max-w-[500px] border border-[#444] shadow-2xl">
            <div class="block-header">
                <span>ГАРАНТ СЕРВИС</span>
                <button onclick="closeModal('modal-escrow')" class="text-textMuted hover:text-white px-2">✕</button>
            </div>
            <div class="p-6 bg-[#181818] text-[#ccc] text-base leading-relaxed">
                <p class="mb-4">Мы предоставляем услуги Гаранта для безопасных сделок.</p>
                <ul class="list-decimal list-inside space-y-1 mb-4 text-[#ddd]">
                    <li>Полная анонимность обеих сторон.</li>
                    <li>Холдирование средств до получения товара.</li>
                    <li>Разрешение спорных ситуаций (арбитраж).</li>
                </ul>
                <p>Мы работаем на совесть уже много лет и дорожим своей репутацией. Все данные шифруются, логи удаляются мгновенно.</p>
            </div>
            <div class="p-3 bg-[#151515] border-t border-[#2d2d2d] flex justify-center">
                <a href="https://t.me/lkx_kxl" target="_blank" class="btn-forum btn-action px-6 font-bold py-2 no-underline">Начать сделку</a>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast-area" class="fixed bottom-5 left-5 z-[100] flex flex-col gap-2 pointer-events-none"></div>

    <script>
        const DB = [
            { id: 101, cat: 'combat', title: 'АК-74М (СХП) Ижмаш', author: 'GunDealer', price: 45000, desc: 'Полный комплект. Документы. Склад.' },
            { id: 102, cat: 'combat', title: 'АКС-74У Тула 1986', author: 'RareGuns', price: 58000, desc: 'Коллекционный сохран. Дерево лак.' },
            { id: 103, cat: 'combat', title: 'ПМ-СХ 1972', author: 'Makarov_Boss', price: 28500, desc: 'Красный зип. Идеал.' },
            { id: 104, cat: 'traumatic', title: 'Grand Power T12', author: 'SlovakImport', price: 45000, desc: 'Словакия. Без штифта.' },
            { id: 105, cat: 'traumatic', title: 'ПМ-Т (ЗиД)', author: 'Legend_ZZ', price: 68000, desc: 'Донор 1968. Работает на всем.' },
            { id: 106, cat: 'other', title: 'Бронежилет 6Б45', author: 'VoenSklad', price: 18500, desc: 'Ратник. Плиты 5А. Размер 2.' },
            { id: 107, cat: 'other', title: 'Цинк 5.45х39 (7Н6)', author: 'Ammo_Master', price: 42000, desc: '1080 шт. Запечатан.' },
            { id: 108, cat: 'other', title: 'Шлем 6Б47', author: 'VoenSklad', price: 12000, desc: 'Новый с чехлом. Размер 2.' },
            { id: 109, cat: 'combat', title: 'СВД Тигр', author: 'Sniper_Elite', price: 85000, desc: 'Длинный ствол. ПСО-1.' }
        ];

        const LOCATIONS = { 
            ru: ["Москва", "Санкт-Петербург", "Екатеринбург", "Новосибирск"], 
            ua: ["Киев", "Одесса", "Харьков", "Львов"], 
            kz: ["Алматы", "Астана", "Шымкент"], 
            by: ["Минск", "Гомель"] 
        };
        const WALLETS = { 
            usdt: { addr: "TRxXRhED1G12UEF74riYfkxxws8fKEC4Ca", name: "TRC20", rateId: 102 }, 
            btc: { addr: "bc1qfutymnq0m7ekah54gxjwq00rdstvg6k0duvdl5", name: "BTC", rateId: 9800000 }, 
            ltc: { addr: "ltc1qhnqel0z5qfdl8efyztuu6q2wd6puyfu2u56995", name: "LTC", rateId: 9500 } 
        };

        let cart = [];
        let activeItem = null;
        let timerInt = null;

        function init() {
            renderProducts('all');
            updateCities();
        }

        function renderProducts(cat) {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '';
            
            document.querySelectorAll('.nav-link-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + cat).classList.add('active');

            const filtered = DB.filter(p => cat === 'all' || p.cat === cat);
            const searchVal = document.getElementById('search').value.toLowerCase();
            
            let count = 0;
            const catNames = { all: 'Общий каталог', combat: 'Огнестрельное', traumatic: 'Травматическое', other: 'Снаряжение' };
            document.getElementById('cat-title').textContent = catNames[cat];

            filtered.forEach(p => {
                if (searchVal && !p.title.toLowerCase().includes(searchVal)) return;

                const card = document.createElement('div');
                card.className = 'product-card group cursor-pointer';
                card.onclick = (e) => { if(!e.target.closest('button')) openModalProduct(p.id); };

                card.innerHTML = `
                    <div class="img-placeholder">
                        <span class="group-hover:text-white transition-colors">[ ФОТО ]</span>
                    </div>
                    <div class="p-3 flex flex-col flex-grow bg-[#1c1c1c]">
                        <div class="text-md font-bold text-[#ddd] mb-1 leading-tight group-hover:text-link transition-colors">${p.title}</div>
                        <div class="text-tiny text-textMuted mb-3">Продавец: ${p.author}</div>
                        
                        <div class="mt-auto flex justify-between items-center border-t border-[#2d2d2d] pt-3">
                            <div class="text-lg font-bold text-white">${p.price.toLocaleString()} ₽</div>
                            <button onclick="quickAdd(${p.id})" class="btn-forum text-tiny font-bold uppercase hover:text-white">В корзину</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
                count++;
            });

            document.getElementById('empty-view').style.display = count === 0 ? 'block' : 'none';
        }

        document.getElementById('search').addEventListener('input', () => renderProducts('all'));

        function openModalProduct(id) {
            activeItem = DB.find(x => x.id === id);
            if(!activeItem) return;

            document.getElementById('mp-id').textContent = activeItem.id;
            document.getElementById('mp-vendor').textContent = activeItem.author;
            document.getElementById('mp-name').textContent = activeItem.title;
            document.getElementById('mp-desc').textContent = activeItem.desc;
            document.getElementById('mp-price').textContent = activeItem.price.toLocaleString() + ' ₽';
            
            document.getElementById('modal-product').classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
            if (id === 'modal-cart') clearInterval(timerInt);
        }

        function openRules() { document.getElementById('modal-rules').classList.remove('hidden'); }
        function openEscrow() { document.getElementById('modal-escrow').classList.remove('hidden'); }

        function quickAdd(id) {
            const item = DB.find(x => x.id === id);
            cart.push(item);
            updateCart();
            showToast('Добавлено: ' + item.title);
        }

        function addToCartCurrent() {
            if(!activeItem) return;
            cart.push(activeItem);
            updateCart();
            closeModal('modal-product');
            showToast('Добавлено в корзину');
        }

        function updateCart() {
            document.getElementById('cart-count').textContent = cart.length;
        }

        function openCart() {
            const list = document.getElementById('cart-list');
            list.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                document.getElementById('cart-empty-msg').classList.remove('hidden');
                document.getElementById('cart-footer').classList.add('hidden');
            } else {
                document.getElementById('cart-empty-msg').classList.add('hidden');
                document.getElementById('cart-footer').classList.remove('hidden');
                
                cart.forEach((item, idx) => {
                    total += item.price;
                    const row = document.createElement('div');
                    row.className = 'flex justify-between items-center p-2 bg-[#111] border border-[#2d2d2d] mb-1';
                    row.innerHTML = `
                        <div class="flex flex-col">
                            <span class="text-white font-bold text-tiny truncate w-[200px]">${item.title}</span>
                            <span class="text-textMuted text-tiny">${item.price.toLocaleString()} ₽</span>
                        </div>
                        <button onclick="remCart(${idx})" class="text-[#c53030] font-bold px-2 hover:text-white">✕</button>
                    `;
                    list.appendChild(row);
                });
            }
            document.getElementById('cart-total').textContent = total.toLocaleString() + ' ₽';
            toCartView();
            document.getElementById('modal-cart').classList.remove('hidden');
        }

        function remCart(idx) {
            cart.splice(idx, 1);
            openCart();
            updateCart();
        }

        function toCartView() {
            document.getElementById('view-cart-list').classList.remove('hidden');
            document.getElementById('view-checkout').classList.add('hidden');
            document.getElementById('view-invoice').classList.add('hidden');
            document.getElementById('cart-modal-title').textContent = 'Корзина';
        }

        function toCheckout() {
            document.getElementById('view-cart-list').classList.add('hidden');
            document.getElementById('view-checkout').classList.remove('hidden');
            document.getElementById('cart-modal-title').textContent = 'Оформление заказа';
            updateCities();
        }

        function toInvoice() {
            const payMethod = document.querySelector('input[name="payment"]:checked').value;
            const total = cart.reduce((sum, i) => sum + i.price, 0);
            const wallet = WALLETS[payMethod];
            const amount = (total / wallet.rateId).toFixed(payMethod === 'btc' ? 6 : 2);

            document.getElementById('inv-rub').textContent = total.toLocaleString();
            document.getElementById('inv-crypto').textContent = amount + ' ' + wallet.name;
            document.getElementById('inv-wallet-name').textContent = wallet.name;
            document.getElementById('inv-addr').textContent = wallet.addr;

            document.getElementById('view-checkout').classList.add('hidden');
            document.getElementById('view-invoice').classList.remove('hidden');
            document.getElementById('cart-modal-title').textContent = 'Оплата';
            startTimer();
        }

        function updateCities() {
            const c = document.getElementById('co-country').value;
            const s = document.getElementById('co-city');
            s.innerHTML = '';
            LOCATIONS[c].forEach(city => {
                const opt = document.createElement('option');
                opt.value = city;
                opt.textContent = city;
                s.appendChild(opt);
            });
        }

        function startTimer() {
            clearInterval(timerInt);
            let t = 900; 
            const el = document.getElementById('timer');
