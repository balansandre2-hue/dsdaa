<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T.M. // MARKETPLACE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        const origWarn = console.warn;
        console.warn = (...args) => {
            if (args[0] && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) return;
            origWarn.apply(console, args);
        };
        
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 
                        bg: '#0f0f0f',
                        surface: '#1a1a1a',
                        border: '#333333',
                        text: '#cccccc',
                        accent: '#4ade80' // Terminal green
                    },
                    fontFamily: {
                        mono: ['"Courier New"', 'Courier', 'monospace'],
                        sans: ['Verdana', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f0f0f; color: #cccccc; font-family: Verdana, sans-serif; font-size: 13px; }
        .font-mono { font-family: 'Courier New', Courier, monospace; }
        
        /* –°—Ç—Ä–æ–≥–∏–π —Å—Ç–∏–ª—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f0f0f; border-left: 1px solid #333; }
        ::-webkit-scrollbar-thumb { background: #333; border: 1px solid #0f0f0f; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

        /* –£–±–∏—Ä–∞–µ–º —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã */
        .btn { border: 1px solid #333; background: #1a1a1a; color: #ccc; transition: all 0.1s; text-transform: uppercase; font-size: 11px; letter-spacing: 1px; }
        .btn:hover { background: #252525; border-color: #555; color: #fff; }
        .btn:active { background: #333; }
        
        .btn-primary { border: 1px solid #166534; background: #052e16; color: #4ade80; }
        .btn-primary:hover { background: #14532d; border-color: #22c55e; }

        .panel { background: #161616; border: 1px solid #333; }
        
        .modal-overlay { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(2px); }
        .modal { transition: opacity 0.1s ease; }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤ –ø–æ–¥ –ø–æ—Å—Ç—ã —Ñ–æ—Ä—É–º–∞ */
        .forum-post { border-left: 2px solid #333; padding-left: 10px; margin-bottom: 10px; }
        .forum-header { font-size: 10px; color: #666; margin-bottom: 4px; font-family: 'Courier New', monospace; }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –¥–ª—è –∏–Ω–ø—É—Ç–æ–≤ */
        input, select { background: #0a0a0a; border: 1px solid #333; color: #fff; border-radius: 0; font-family: 'Courier New', monospace; }
        input:focus, select:focus { border-color: #555; outline: none; background: #111; }

        /* Toast notifications */
        .toast { border: 1px solid #333; background: #111; font-family: 'Courier New', monospace; font-size: 12px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <nav class="bg-surface border-b border-border sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-14">
                <!-- –õ–æ–≥–æ—Ç–∏–ø -->
                <div class="flex items-center gap-3 cursor-pointer" onclick="renderProducts('all')">
                    <div class="w-3 h-3 bg-accent animate-pulse"></div>
                    <span class="font-mono font-bold text-lg tracking-widest text-white">TM//MARKET</span>
                </div>
                
                <!-- –ú–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
                <div class="hidden md:flex space-x-px bg-border">
                    <button onclick="renderProducts('all')" class="btn px-4 py-2 hover:bg-surface border-none">–í–°–ï –õ–û–¢–´</button>
                    <button onclick="renderProducts('combat')" class="btn px-4 py-2 hover:bg-surface border-none">–ë–û–ï–í–û–ï</button>
                    <button onclick="renderProducts('traumatic')" class="btn px-4 py-2 hover:bg-surface border-none">–û–û–û–ü</button>
                    <button onclick="renderProducts('other')" class="btn px-4 py-2 hover:bg-surface border-none">–ó–ò–ü/–ë–ö</button>
                </div>

                <!-- –ü–æ–∏—Å–∫ –∏ –∫–æ—Ä–∑–∏–Ω–∞ -->
                <div class="flex items-center gap-4">
                    <div class="relative hidden sm:block">
                        <input type="text" id="search" placeholder="SEARCH_QUERY..." class="w-48 py-1 px-2 text-xs">
                    </div>
                    
                    <button onclick="openCart()" class="btn p-2 flex items-center gap-2">
                        <span>CART</span>
                        <span id="cart-count" class="bg-border px-1.5 py-0.5 text-[10px] text-white hidden">0</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é -->
        <div class="md:hidden grid grid-cols-4 border-t border-border bg-black text-[10px]">
            <button onclick="renderProducts('all')" class="p-2 border-r border-border hover:bg-surface text-center">ALL</button>
            <button onclick="renderProducts('combat')" class="p-2 border-r border-border hover:bg-surface text-center">CMBT</button>
            <button onclick="renderProducts('traumatic')" class="p-2 border-r border-border hover:bg-surface text-center">TRMA</button>
            <button onclick="renderProducts('other')" class="p-2 hover:bg-surface text-center">GEAR</button>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="flex-grow max-w-7xl mx-auto px-4 py-6 w-full">
        <!-- –°—Ç–∞—Ç—É—Å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ -->
        <div class="mb-6 font-mono text-xs border border-border p-3 bg-black/50 flex flex-col md:flex-row justify-between items-start md:items-center gap-2">
            <div class="text-gray-500">
                STATUS: <span class="text-accent">ONLINE</span> | ENCRYPTION: <span class="text-accent">AES-256</span> | NODE: <span class="text-blue-400">AMS-3</span>
            </div>
            <div class="text-gray-400">
                <span class="text-yellow-600">[WARN]</span> –†–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –≥–∞—Ä–∞–Ω—Ç-—Å–µ—Ä–≤–∏—Å –∏–ª–∏ –ø—Ä—è–º—É—é –æ–ø–ª–∞—Ç—É.
            </div>
        </div>

        <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
        
        <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-gray-600 font-mono">
            <span>[NO_DATA_FOUND]</span>
            <button onclick="handleSearch('')" class="mt-2 text-accent hover:underline text-xs">[RESET_FILTER]</button>
        </div>
    </main>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="border-t border-border bg-surface py-6 mt-auto font-mono text-xs text-gray-600">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <p>&copy; 2026 TACTICAL_MARKET. Onion V3.</p>
            <div class="flex gap-6">
                <a href="#" class="hover:text-gray-400">[ESCROW]</a>
                <a href="#" class="hover:text-gray-400">[PGP_KEY]</a>
                <a href="https://t.me/+l4Mt8VCqCf42ZDU5" target="_blank" class="hover:text-gray-400">[FEEDBACK]</a>
            </div>
        </div>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞ -->
    <div id="product-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-overlay absolute inset-0" onclick="closeProductModal()"></div>
        <div class="relative bg-surface w-full max-w-3xl border border-border shadow-2xl flex flex-col max-h-[90vh]">
            
            <div class="flex justify-between items-center px-4 py-2 border-b border-border bg-black">
                <h3 class="font-mono font-bold text-white text-sm">ITEM_VIEWER.EXE</h3>
                <button onclick="closeProductModal()" class="text-gray-500 hover:text-white font-mono">[X]</button>
            </div>

            <div class="overflow-y-auto p-6 custom-scrollbar bg-[#111]">
                <div class="flex flex-col md:flex-row gap-6 mb-6">
                    <!-- –ò–∫–æ–Ω–∫–∞ -->
                    <div class="w-full md:w-48 h-48 bg-black border border-border flex items-center justify-center text-6xl grayscale opacity-80">
                        <span id="pm-icon"></span>
                    </div>
                    
                    <div class="flex-grow font-mono">
                        <div class="flex justify-between items-start mb-2">
                            <h2 id="pm-name" class="text-xl font-bold text-white uppercase tracking-wider"></h2>
                            <span id="pm-badge" class="hidden px-1.5 py-0.5 border border-gray-600 text-gray-400 text-[10px]"></span>
                        </div>
                        
                        <div class="flex items-center gap-2 mb-4 text-xs text-gray-500">
                            <span>RATING:</span>
                            <span id="pm-rating" class="text-yellow-600 font-bold"></span>
                            <span class="text-gray-700">|</span>
                            <span>ID: <span id="pm-id-display"></span></span>
                        </div>

                        <div class="mb-4 bg-black border border-border p-3 text-xs text-gray-400 leading-relaxed whitespace-pre-line" id="pm-desc"></div>

                        <div class="flex items-center justify-between mt-auto">
                            <span id="pm-price" class="text-xl text-accent font-bold"></span>
                            <button onclick="addToCartCurrent()" class="btn-primary px-6 py-3 font-bold text-xs tracking-wider">–î–û–ë–ê–í–ò–¢–¨ –í –ó–ê–ö–ê–ó</button>
                        </div>
                    </div>
                </div>
                
                <!-- –û—Ç–∑—ã–≤—ã -->
                <div class="border-t border-border pt-4">
                    <h4 class="font-mono text-xs text-gray-500 mb-3">[ USER_FEEDBACK_LOG ]</h4>
                    <div id="pm-reviews" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ö–æ—Ä–∑–∏–Ω–∞ / –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ -->
    <div id="cart-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-overlay absolute inset-0" onclick="closeCartModal()"></div>
        <div class="relative bg-surface w-full max-w-lg border border-border shadow-2xl flex flex-col max-h-[90vh]">
            
            <div class="flex justify-between items-center px-4 py-2 border-b border-border bg-black">
                <h3 id="cart-title" class="font-mono font-bold text-white text-sm">ORDER_MANAGER</h3>
                <button onclick="closeCartModal()" class="text-gray-500 hover:text-white font-mono">[X]</button>
            </div>

            <div class="overflow-y-auto p-5 custom-scrollbar bg-[#111] flex-grow font-mono">
                
                <!-- 1. –°–ø–∏—Å–æ–∫ -->
                <div id="view-cart-list">
                    <div id="cart-items" class="space-y-2 mb-6"></div>
                    <div id="cart-empty" class="text-center py-8 text-gray-600 text-xs border border-dashed border-border">[EMPTY_BUFFER]</div>
                    
                    <div id="cart-summary" class="border-t border-border pt-4 mt-4 hidden">
                        <div class="flex justify-between items-center mb-4 text-sm">
                            <span class="text-gray-500">TOTAL_SUM:</span>
                            <span id="cart-total" class="font-bold text-white">0 ‚ÇΩ</span>
                        </div>
                        <button onclick="toCheckout()" class="btn-primary w-full py-3 font-bold">INITIATE_CHECKOUT</button>
                    </div>
                </div>

                <!-- 2. –î–∞–Ω–Ω—ã–µ -->
                <div id="view-checkout" class="hidden space-y-4">
                    <div class="text-[10px] text-gray-500 cursor-pointer hover:text-white mb-2" onclick="toCartView()">&lt; BACK</div>

                    <div class="bg-blue-900/10 border border-blue-900/30 p-2 text-[10px] text-blue-500">
                        INFO: –î–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è PGP. –õ–æ–≥–∏ –Ω–µ –≤–µ–¥—É—Ç—Å—è.
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] text-gray-500 mb-1">LOCATION</label>
                            <select id="country" class="w-full py-2 px-2 text-xs" onchange="updateCities()">
                                <option value="ru">RUS (RF)</option>
                                <option value="ua">UKR (UA)</option>
                                <option value="kz">KAZ (KZ)</option>
                                <option value="by">BLR (BY)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] text-gray-500 mb-1">CITY_NODE</label>
                            <select id="city" class="w-full py-2 px-2 text-xs"></select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] text-gray-500 mb-1">CONTACT_EMAIL (OPTIONAL)</label>
                        <input type="email" id="email" placeholder="anon@proton.me" class="w-full py-2 px-2 text-xs">
                    </div>

                    <div>
                        <label class="block text-[10px] text-gray-500 mb-1">DELIVERY_METHOD</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="cursor-pointer">
                                <input type="radio" name="delivery" value="courier" class="peer sr-only" checked>
                                <div class="text-center py-2 border border-border peer-checked:bg-border peer-checked:text-white text-gray-500 text-xs hover:border-gray-600 transition">
                                    COURIER
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="delivery" value="drop" class="peer sr-only">
                                <div class="text-center py-2 border border-border peer-checked:bg-border peer-checked:text-white text-gray-500 text-xs hover:border-gray-600 transition">
                                    DEAD_DROP
                                </div>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] text-gray-500 mb-1">PAYMENT_GATEWAY</label>
                        <div class="space-y-1">
                            <label class="flex items-center justify-between p-2 border border-border cursor-pointer hover:bg-black">
                                <span class="flex items-center gap-2 text-xs">USDT (TRC20)</span>
                                <input type="radio" name="payment" value="usdt" checked class="accent-green-500">
                            </label>
                            <label class="flex items-center justify-between p-2 border border-border cursor-pointer hover:bg-black">
                                <span class="flex items-center gap-2 text-xs">BITCOIN (BTC)</span>
                                <input type="radio" name="payment" value="btc" class="accent-green-500">
                            </label>
                            <label class="flex items-center justify-between p-2 border border-border cursor-pointer hover:bg-black">
                                <span class="flex items-center gap-2 text-xs">LITECOIN (LTC)</span>
                                <input type="radio" name="payment" value="ltc" class="accent-green-500">
                            </label>
                        </div>
                    </div>

                    <button onclick="toInvoice()" class="btn-primary w-full py-3 mt-2 font-bold">CONFIRM_ORDER</button>
                </div>

                <!-- 3. –ò–Ω–≤–æ–π—Å -->
                <div id="view-invoice" class="hidden text-center">
                    <h3 class="text-sm font-bold text-white mb-2 uppercase border-b border-border pb-2">Awaiting Payment</h3>
                    <div id="timer" class="text-xl text-red-600 font-bold mb-4 animate-pulse">15:00</div>
                    
                    <div class="bg-black border border-border p-4 text-left mb-4 font-mono text-xs">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-500">FIAT_AMOUNT:</span>
                            <span id="inv-rub" class="text-white"></span>
                        </div>
                        <div class="flex justify-between mb-4">
                            <span class="text-gray-500">CRYPTO_AMOUNT:</span>
                            <span id="inv-crypto" class="text-accent font-bold"></span>
                        </div>
                        <div class="pt-2 border-t border-border">
                            <div class="text-[9px] text-gray-600 mb-1">WALLET_ADDRESS (<span id="inv-wallet-name"></span>)</div>
                            <div class="bg-[#050505] p-2 border border-border break-all text-white cursor-pointer hover:text-accent transition" id="inv-addr" onclick="copyWallet()"></div>
                            <div class="text-right mt-1"><span class="text-[9px] text-blue-500 cursor-pointer hover:underline" onclick="copyWallet()">[COPY]</span></div>
                        </div>
                    </div>
                    
                    <button onclick="showToast('Transaction verifying...', 'success'); closeCartModal(); cart=[]; updateCartUI();" class="btn w-full py-2">MARK_AS_PAID</button>
                </div>

            </div>
        </div>
    </div>

    <div id="toast-container" class="fixed bottom-5 right-5 flex flex-col gap-2 z-50"></div>

    <script>
        const PRODUCTS = [
            { id: "c1", cat: "combat", name: "AK-74M [IZHMASH]", price: 45000, icon: "‚öîÔ∏è", badge: "HIT", rating: "4.9/5", desc: "–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑–µ—Ü (–°–•–ü). –î–µ–∞–∫—Ç–∏–≤ –∑–∞–≤–æ–¥—Å–∫–æ–π. –ú–µ—Ö–∞–Ω–∏–∫–∞ –≤ –∏–¥–µ–∞–ª–µ. –î–æ–∫—É–º–µ–Ω—Ç—ã –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ.\n–ö–∞–ª–∏–±—Ä: 5.45x39\n–°–æ—Å—Ç–æ—è–Ω–∏–µ: –°–∫–ª–∞–¥", reviews: [{u:"user_3421",t:"–ü–æ–ª—É—á–∏–ª –∑–∞–∫–ª–∞–¥–∫–æ–π. –í—Å–µ —Ä–æ–≤–Ω–æ. –°–º–∞–∑–∫–∞ –≤ –Ω–æ—Ä–º–µ.",r:5}, {u:"ak_lover",t:"–î–æ—Å—Ç–∞–≤–∫–∞ 3 –¥–Ω—è. –£–ø–∞–∫–æ–≤–∫–∞ - –º–æ–µ –ø–æ—á—Ç–µ–Ω–∏–µ.",r:5}] },
            { id: "c2", cat: "combat", name: "AKS-74U 'KRINKOV'", price: 52000, icon: "üå™", badge: null, rating: "5.0/5", desc: "–£–∫–æ—Ä–æ—á–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è. –î–µ—Ä–µ–≤–æ —Ä–æ–¥–Ω–æ–µ, –ª–∞–∫. –ù–æ–º–µ—Ä–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç.\n–ö–∞–ª–∏–±—Ä: 5.45x39\n–í–µ—Å: 2.7–∫–≥", reviews: [{u:"driver_msk",t:"–î–ª—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–∞–º–æ–µ —Ç–æ. –ü—Ä–æ–¥–∞–≤—Ü—É —Ä–µ—Å–ø–µ–∫—Ç.",r:5}] },
            { id: "c3", cat: "combat", name: "AKM [1960s]", price: 48000, icon: "üî•", badge: "RARE", rating: "4.8/5", desc: "–°–æ–≤–µ—Ç—Å–∫–∞—è –∫–ª–∞—Å—Å–∏–∫–∞. –¢—É–ª—å—Å–∫–∏–π –æ—Ä—É–∂–µ–π–Ω—ã–π. –§—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞.\n–ö–∞–ª–∏–±—Ä: 7.62x39", reviews: [{u:"collect_01",t:"–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –≤–µ—â—å. –¢—è–∂–µ–ª—ã–π, –Ω–∞–¥–µ–∂–Ω—ã–π.",r:5}] },
            { id: "c4", cat: "combat", name: "SVD [DRAGUNOV]", price: 85000, icon: "üéØ", badge: null, rating: "5.0/5", desc: "–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞. –í –∫–æ–º–ø–ª–µ–∫—Ç–µ –ü–°–û-1 (—Å–µ—Ç–∫–∞ —Ü–µ–ª–∞—è). –ß–µ—Ö–æ–ª.\n–ö–∞–ª–∏–±—Ä: 7.62x54R", reviews: [{u:"scope_x",t:"–õ–∏–Ω–∑—ã —á–∏—Å—Ç—ã–µ. –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —á–∞—Å—ã.",r:5}] },
            { id: "c5", cat: "combat", name: "PM [MAKAROV]", price: 25000, icon: "‚≠ê", badge: "TOP", rating: "4.7/5", desc: "–ü–ú –æ–±—Ä–∞–∑—Ü–∞ 80-—Ö. –ö—Ä–∞—Å–Ω—ã–π –∑–∏–ø. –í–æ—Ä–æ–Ω–µ–Ω–∏–µ –Ω–µ —Å—Ç–µ—Ä—Ç–æ.\n–ö–∞–ª–∏–±—Ä: 9x18", reviews: [{u:"anon_99",t:"–ö–ª–∞—Å—Å–∏–∫–∞ –∂–∞–Ω—Ä–∞. –í –º–∞—Å–ª–µ.",r:4}] },
            { id: "c6", cat: "combat", name: "TT-33 [TOKAREV]", price: 32000, icon: "üî´", badge: null, rating: "4.9/5", desc: "–í–æ–µ–Ω–Ω—ã–π –≤—ã–ø—É—Å–∫. –ë–µ–∑ —Ä–µ–º–æ–Ω—Ç–Ω—ã—Ö –∫–ª–µ–π–º. –°—Ç–≤–æ–ª –Ω–∞ —à—Ç–∏—Ñ—Ç–∞—Ö.\n–ö–∞–ª–∏–±—Ä: 7.62x25", reviews: [{u:"history_buff",t:"–ú–æ—â–Ω–∞—è –≤–µ—â—å. –ü—Ä–æ–±–∏–≤–∞–µ—Ç –Ω–∞ —É—Ä–∞.",r:5}] },
            { id: "c7", cat: "combat", name: "APS [STECHKIN]", price: 110000, icon: "üß®", badge: "NEW", rating: "5.0/5", desc: "–ê–ü–° —Ä–∞–Ω–Ω–∏–π. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–≥–æ–Ω—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω (—Ö–æ–ª–æ—Å—Ç–æ–π).\n–ö–∞–ª–∏–±—Ä: 9x18\n–ö–æ–º–ø–ª–µ–∫—Ç: –ö–æ–±—É—Ä–∞-–ø—Ä–∏–∫–ª–∞–¥", reviews: [{u:"vip_client",t:"–†–µ–¥–∫–æ—Å—Ç—å –Ω–µ—Ä–µ–∞–ª—å–Ω–∞—è. –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–Ω—Ç.",r:5}] },
            
            { id: "t1", cat: "traumatic", name: "OSA PB-4-2", price: 14500, icon: "üõ°", badge: null, rating: "4.6/5", desc: "–ö–æ–º–ø–ª–µ–∫—Å —Å–∞–º–æ–æ–±–æ—Ä–æ–Ω—ã. –≠–ª–µ–∫—Ç—Ä–æ—Å–ø—É—Å–∫. –õ–∞–∑–µ—Ä–Ω—ã–π —Ü–µ–ª–µ—É–∫–∞–∑–∞—Ç–µ–ª—å.\n–ö–∞–ª–∏–±—Ä: 18.5x55", reviews: [{u:"def_user",t:"–í–∞–ª–∏—Ç —Å –Ω–æ–≥. –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ.",r:5}] },
            { id: "t2", cat: "traumatic", name: "PM-T [ZID]", price: 65000, icon: "üí•", badge: "HIT", rating: "4.8/5", desc: "–ü–µ—Ä–µ–¥–µ–ª–∫–∞ –∏–∑ –±–æ–µ–≤–æ–≥–æ. –°—Ç–≤–æ–ª —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–µ–≥—Ä–∞–¥–∞–º–∏.\n–ö–∞–ª–∏–±—Ä: 9mm PA", reviews: [{u:"killa",t:"–õ—É—á—à–∏–π —Ç—Ä–∞–≤–º–∞—Ç –Ω–∞ —Ä—ã–Ω–∫–µ. –ñ—Ä–µ—Ç –≤—Å—ë.",r:5}] },
            { id: "t3", cat: "traumatic", name: "GRAND POWER T12", price: 42000, icon: "ü¶æ", badge: "TOP", rating: "4.9/5", desc: "–°–ª–æ–≤–∞–∫–∏—è (–Ω–µ –†–§ —Å–±–æ—Ä–∫–∞). –ü–æ–ª–∏–º–µ—Ä–Ω–∞—è —Ä–∞–º–∫–∞. –ú–æ—â–Ω—ã–π —Å—Ç–≤–æ–ª.\n–ö–∞–ª–∏–±—Ä: 10x28", reviews: [{u:"sport_ipsc",t:"–¢–æ—á–Ω–æ—Å—Ç—å –Ω–∞ –≤—ã—Å–æ—Ç–µ. –≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞ —Å—É–ø–µ—Ä.",r:5}] },
            { id: "t4", cat: "traumatic", name: "TT-T [LEADER]", price: 28000, icon: "üß±", badge: null, rating: "4.5/5", desc: "–¢—Ä–∞–≤–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¢–¢. –ü–µ—Ä–µ–¥–µ–ª–∫–∞ –ó–∏–î. –ê—É—Ç–µ–Ω—Ç–∏—á–Ω—ã–π –≤–∏–¥.\n–ö–∞–ª–∏–±—Ä: 10x28", reviews: [{u:"old_school",t:"–î–ª—è –¥—É—à–∏ –ø–æ–π–¥–µ—Ç. –ò–Ω–æ–≥–¥–∞ –∫–ª–∏–Ω–∏—Ç –Ω–∞ —Å–ª–∞–±—ã—Ö –ø–∞—Ç—Ä–æ–Ω–∞—Ö.",r:4}] },

            { id: "o1", cat: "other", name: "CRATE 5.45x39", price: 45000, icon: "üì¶", badge: "BULK", rating: "-", desc: "–¶–∏–Ω–∫ 1080—à—Ç. –ì–µ—Ä–º–µ—Ç–∏—á–Ω—ã–π. –ê—Ä–º–µ–π—Å–∫–∏–π –∑–∞–ø–∞—Å.\n–¢–∏–ø: 7–ù6 (–ü–°)", reviews: [] },
            { id: "o2", cat: "other", name: "AMMO 7.62x39", price: 3800, icon: "üíä", badge: null, rating: "-", desc: "–ü–∞—á–∫–∞ 50—à—Ç. –ë–ü–ó/–¢—É–ª–∞.\n–¢–∏–ø: FMJ", reviews: [] },
            { id: "o3", cat: "other", name: "AMMO 9x18 PM", price: 3200, icon: "üç¨", badge: null, rating: "-", desc: "–ü–∞—á–∫–∞ 50—à—Ç. –ü–ü–û/–ü–°.\n–¢–∏–ø: –°—Ç–∞–Ω–¥–∞—Ä—Ç", reviews: [] },
            { id: "o4", cat: "other", name: "AMMO 9x19 LUGER", price: 3500, icon: "üîò", badge: null, rating: "-", desc: "–ü–∞—á–∫–∞ 50—à—Ç. NATO Standard.", reviews: [] },
            { id: "o5", cat: "other", name: "KYDEX HOLSTER", price: 4500, icon: "üëñ", badge: "NEW", rating: "4.7/5", desc: "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–æ–±—É—Ä–∞. –§–æ—Ä–º–æ–≤–∫–∞ –ø–æ–¥ –∑–∞–∫–∞–∑. –ö–ª–∏–ø—Å–∞ —Å—Ç–∞–ª—å.", reviews: [] },
            { id: "o6", cat: "other", name: "HARD CASE IP67", price: 12000, icon: "üß≥", badge: null, rating: "5.0/5", desc: "–ö–µ–π—Å —É–¥–∞—Ä–æ–ø—Ä–æ—á–Ω—ã–π. –ü–æ—Ä–æ–ª–æ–Ω –∫—É–±–∏–∫–∞–º–∏. –í–ª–∞–≥–æ–∑–∞—â–∏—Ç–∞.", reviews: [] }
        ];

        const LOCATIONS = { ru: ["MSK", "SPB", "EKB", "NSK"], ua: ["KIEV", "ODESSA", "LVIV"], kz: ["ALMATY", "ASTANA"], by: ["MINSK", "GOMEL"] };
        const WALLETS = { usdt: { addr: "TRxXRhED1G12UEF74riYfkxxws8fKEC4Ca", name: "TRC20", rateId: "tether" }, btc: { addr: "bc1qfutymnq0m7ekah54gxjwq00rdstvg6k0duvdl5", name: "BTC", rateId: "bitcoin" }, ltc: { addr: "ltc1qhnqel0z5qfdl8efyztuu6q2wd6puyfu2u56995", name: "LTC", rateId: "litecoin" } };

        let cart = [];
        let rates = { tether: 98, bitcoin: 9500000, litecoin: 9500 };
        let currentItem = null;
        let timerInt = null;

        function init() {
            renderProducts('all');
        }

        function renderProducts(filter) {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '';
            let count = 0;
            const searchQ = document.getElementById('search').value.toLowerCase();

            PRODUCTS.forEach(p => {
                if (filter !== 'all' && p.cat !== filter) return;
                if (searchQ && !p.name.toLowerCase().includes(searchQ)) return;

                const card = document.createElement('div');
                card.className = "panel p-4 flex flex-col hover:bg-[#1a1a1a] cursor-pointer group transition-colors";
                card.onclick = (e) => { if(!e.target.closest('button')) openProduct(p.id); };

                let badgeHTML = p.badge ? `<span class="text-[9px] border border-blue-900 text-blue-400 px-1 ml-2">${p.badge}</span>` : '';

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="text-4xl grayscale opacity-70 group-hover:opacity-100 transition-opacity">${p.icon}</div>
                        <div class="text-right">
                            <div class="text-accent font-mono font-bold">${p.price.toLocaleString()} ‚ÇΩ</div>
                            <div class="text-[9px] text-gray-600">ID: ${p.id.toUpperCase()}</div>
                        </div>
                    </div>
                    <div class="flex items-center mb-1">
                        <h3 class="font-bold text-gray-300 text-sm group-hover:text-white uppercase">${p.name}</h3>
                        ${badgeHTML}
                    </div>
                    <div class="text-[10px] text-gray-500 mb-3 font-mono">${p.desc.split('\n')[0]}</div>
                    <div class="mt-auto flex justify-between items-center border-t border-[#333] pt-2">
                        <span class="text-[10px] text-gray-600">R: ${p.rating}</span>
                        <button onclick="addToCart('${p.id}'); event.stopPropagation()" class="text-[10px] text-gray-400 hover:text-white uppercase">[+ ADD]</button>
                    </div>
                `;
                grid.appendChild(card);
                count++;
            });
            document.getElementById('empty-state').style.display = count === 0 ? 'flex' : 'none';
        }

        function handleSearch() { renderProducts('all'); }

        function openProduct(id) {
            currentItem = PRODUCTS.find(p => p.id === id);
            if (!currentItem) return;
            document.getElementById('pm-icon').textContent = currentItem.icon;
            document.getElementById('pm-name').textContent = currentItem.name;
            document.getElementById('pm-price').textContent = currentItem.price.toLocaleString() + ' ‚ÇΩ';
            document.getElementById('pm-desc').textContent = currentItem.desc;
            document.getElementById('pm-rating').textContent = currentItem.rating;
            document.getElementById('pm-id-display').textContent = currentItem.id.toUpperCase();
            
            const badgeEl = document.getElementById('pm-badge');
            if (currentItem.badge) { badgeEl.textContent = currentItem.badge; badgeEl.classList.remove('hidden'); } 
            else { badgeEl.classList.add('hidden'); }

            const rDiv = document.getElementById('pm-reviews');
            rDiv.innerHTML = currentItem.reviews.length ? currentItem.reviews.map(r => `
                <div class="forum-post">
                    <div class="forum-header">USER: <span class="text-gray-400">${r.u}</span> | RATE: ${r.r}/5</div>
                    <p class="text-xs text-gray-400 italic">"${r.t}"</p>
                </div>`).join('') : '<div class="text-xs text-gray-700">[NO_LOGS]</div>';
            
            const modal = document.getElementById('product-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('active'), 10);
            updateCities();
        }

        function addToCartCurrent() { if(currentItem) addToCart(currentItem.id); closeProductModal(); }

        function addToCart(id) {
            const prod = PRODUCTS.find(p => p.id === id);
            cart.push(prod);
            updateCartUI();
            showToast(`ITEM_ADDED: ${prod.name}`, 'success');
        }

        function updateCartUI() {
            const badge = document.getElementById('cart-count');
            badge.textContent = cart.length;
            badge.style.display = cart.length > 0 ? 'inline-block' : 'none';
        }

        function openCart() {
            const list = document.getElementById('cart-items');
            list.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                document.getElementById('cart-empty').style.display = 'block';
                document.getElementById('cart-summary').style.display = 'none';
            } else {
                document.getElementById('cart-empty').style.display = 'none';
                document.getElementById('cart-summary').style.display = 'block';
                cart.forEach((item, index) => {
                    total += item.price;
                    const el = document.createElement('div');
                    el.className = "flex justify-between items-center border-b border-[#333] py-2 text-xs";
                    el.innerHTML = `
                        <div class="flex items-center gap-2">
                            <span class="grayscale text-base">${item.icon}</span>
                            <span class="text-gray-300 font-mono">${item.name}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-gray-500">${item.price}</span>
                            <button onclick="removeFromCart(${index})" class="text-red-900 hover:text-red-500">[x]</button>
                        </div>
                    `;
                    list.appendChild(el);
                });
            }
            document.getElementById('cart-total').textContent = total.toLocaleString() + ' ‚ÇΩ';
            toCartView();
            const modal = document.getElementById('cart-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('active'), 10);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartUI();
            openCart();
        }

        function closeProductModal() { document.getElementById('product-modal').classList.remove('active'); setTimeout(() => document.getElementById('product-modal').classList.add('hidden'), 200); }
        function closeCartModal() { document.getElementById('cart-modal').classList.remove('active'); setTimeout(() => document.getElementById('cart-modal').classList.add('hidden'), 200); clearInterval(timerInt); }

        function toCartView() {
            document.getElementById('view-cart-list').classList.remove('hidden');
            document.getElementById('view-checkout').classList.add('hidden');
            document.getElementById('view-invoice').classList.add('hidden');
            document.getElementById('cart-title').textContent = "ORDER_MANAGER";
        }
        function toCheckout() {
            document.getElementById('view-cart-list').classList.add('hidden');
            document.getElementById('view-checkout').classList.remove('hidden');
            document.getElementById('cart-title').textContent = "SECURE_CHECKOUT";
            updateCities();
        }
        function toInvoice() {
            const payMethod = document.querySelector('input[name="payment"]:checked').value;
            const total = cart.reduce((sum, i) => sum + i.price, 0);
            const wallet = WALLETS[payMethod];
            const amount = (total / rates[wallet.rateId]).toFixed(payMethod === 'btc' ? 6 : 4);

            document.getElementById('inv-rub').textContent = total.toLocaleString() + ' RUB';
            document.getElementById('inv-crypto').textContent = `${amount} ${wallet.name}`;
            document.getElementById('inv-wallet-name').textContent = wallet.name;
            document.getElementById('inv-addr').textContent = wallet.addr;

            document.getElementById('view-checkout').classList.add('hidden');
            document.getElementById('view-invoice').classList.remove('hidden');
            startTimer();
        }

        function updateCities() {
            const c = document.getElementById('country').value;
            const s = document.getElementById('city');
            s.innerHTML = '';
            LOCATIONS[c].forEach(city => {
                const opt = document.createElement('option');
                opt.value = city;
                opt.textContent = city;
                s.appendChild(opt);
            });
        }

        function startTimer() {
            clearInterval(timerInt);
            let t = 900; 
            const el = document.getElementById('timer');
            const tick = () => {
                const m = Math.floor(t / 60).toString().padStart(2, '0');
                const s = (t % 60).toString().padStart(2, '0');
                el.textContent = `${m}:${s}`;
                if (--t < 0) { clearInterval(timerInt); el.textContent = "TIMEOUT"; showToast('SESSION EXPIRED', 'error'); }
            };
            tick();
            timerInt = setInterval(tick, 1000);
        }

        function copyWallet() {
            navigator.clipboard.writeText(document.getElementById('inv-addr').textContent);
            showToast('COPIED_TO_CLIPBOARD', 'success');
        }

        function showToast(msg, type) {
            const box = document.getElementById('toast-container');
            const el = document.createElement('div');
            const color = type === 'success' ? 'border-accent text-accent' : 'border-red-800 text-red-500';
            el.className = `toast p-2 mb-2 bg-black border-l-2 ${color} shadow-lg uppercase tracking-wider`;
            el.textContent = `> ${msg}`;
            box.appendChild(el);
            setTimeout(() => { el.remove(); }, 3000);
        }

        init();
    </script>
</body>
</html>
